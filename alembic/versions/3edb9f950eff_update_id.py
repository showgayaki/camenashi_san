'''update id

Revision ID: 3edb9f950eff
Revises: 47a7ccc37e55
Create Date: 2024-12-04 22:38:38.455560

'''
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '3edb9f950eff'
down_revision: Union[str, None] = '47a7ccc37e55'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_unique_constraint('category_id_unique', 'category', ['id'])
    # ### end Alembic commands ###

    # æ¬¡ã®è¡Œã®å‡¦ç†ã™ã‚‹ãŸã‚ã«ã€ã„ã£ãŸã‚“PRIMARY KEYã‚’å‰Šé™¤
    op.execute('ALTER TABLE category DROP PRIMARY KEY')
    # AUTO_INCREMENTã‚’å‰Šé™¤ã—ã¦PRIMARY KEYã‚’ç¶­æŒ
    op.execute('ALTER TABLE category MODIFY id INT NOT NULL PRIMARY KEY')

    # UNIQUEåˆ¶ç´„ãŒã‚ã‚‹ã®ã§ã€æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã„ã£ãŸã‚“é©å½“ãªã‚‚ã®ã«å¤‰ãˆã¦ãŠã
    op.execute('UPDATE category SET name = "ã‚", emoji = "a" WHERE id = 2')
    op.execute('UPDATE category SET name = "ã„", emoji = "b" WHERE id = 3')

    # ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
    op.execute('INSERT INTO category VALUES (11,"ã—ãƒ¼ã—ãƒ¼","ğŸš½"),(12,"ã†ã‚“ã¡","ğŸ’©")')

    # toiletãƒ†ãƒ¼ãƒ–ãƒ«ã®category_id ã‚’æ›¸ãæ›ãˆ
    op.execute('UPDATE toilet SET category_id = 11 WHERE category_id = 2')
    op.execute('UPDATE toilet SET category_id = 12 WHERE category_id = 3')

    # ãƒ¬ã‚³ãƒ¼ãƒ‰id:2ã‚’ä¿®æ­£
    op.execute('UPDATE category SET name = "ãƒãƒ¼é›†è¨ˆ", emoji = "ğŸ‘" WHERE id = 2')
    # ãƒ¬ã‚³ãƒ¼ãƒ‰id:3ã¯å‰Šé™¤
    op.execute('DELETE FROM category WHERE id = 3')


def downgrade() -> None:
    # å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚’ç„¡åŠ¹ã«ã™ã‚‹
    op.execute('SET FOREIGN_KEY_CHECKS = 0')

    # categoryãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
    op.drop_table('category')
    # categoryãƒ†ãƒ¼ãƒ–ãƒ«ä½œã‚Šç›´ã—
    category = op.create_table('category',
                               sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
                               sa.Column('name', sa.String(length=20), nullable=False),
                               sa.Column('emoji', sa.String(length=20), nullable=False),
                               sa.PrimaryKeyConstraint('id'),
                               sa.UniqueConstraint('emoji'),
                               sa.UniqueConstraint('name')
                               )

    # å…ƒã®ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
    op.bulk_insert(category, [
        {'id': 1, 'name': 'ãƒãƒ¼ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³', 'emoji': ''},
        {'id': 2, 'name': 'ãŠã—ãƒ¼ã—ãƒ¼', 'emoji': 'ğŸš½'},
        {'id': 3, 'name': 'ã†ã‚“ã¡', 'emoji': 'ğŸ’©'},
    ])

    # toiletãƒ†ãƒ¼ãƒ–ãƒ«ã®category_id ã‚’å…ƒã«æˆ»ã™
    op.execute('UPDATE toilet SET category_id = 2 WHERE category_id = 11')
    op.execute('UPDATE toilet SET category_id = 3 WHERE category_id = 12')

    # å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚’æœ‰åŠ¹ã«æˆ»ã™
    op.execute('SET FOREIGN_KEY_CHECKS = 1')
